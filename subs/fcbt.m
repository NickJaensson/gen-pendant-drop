function [ Y ] = fcbt( diffmode, N, M, halfmark )
% chebyshev_polynomial = fcbt(N,M,halfmark) creates the first 30 chebyshev polynomials
% for N points and to M order, halfmark is one if only half the drop shape
% is fitted 0 to 1 instead of -1 to 1.

% create the domain
if exist('halfmark','var')
    if (halfmark == 1)&&strcmp(diffmode,'fd')
        x = linspace(0,1,N)';
    elseif (halfmark == 1)&&strcmp(diffmode,'cheb')
        [~,~,~,x] = dif1D('cheb',0,1,N);
    else
        [~,~,~,x] = dif1D('cheb',-1,2,N); % CHANGED BY NOJ 20-06-2018
        %x = linspace(-1,1,N)';
    end
else
    x = linspace(-1,1,N)';
end

% reserve memory and create powers of x
Y = zeros(N,31);

x2 = x.*x;
x3 = x.*x2;
x4 = x2.*x2;
x5 = x2.*x3;
x6 = x3.*x3;
x7 = x3.*x4;
x8 = x4.*x4;
x9 = x4.*x5;
x10 = x5.*x5;
x11 = x6.*x5;
x12 = x6.*x6;
x13 = x6.*x7;
x14 = x7.*x7;
x15 = x7.*x8;
x16 = x8.*x8;
x17 = x8.*x9;
x18 = x9.*x9;
x19 = x9.*x10;
x20 = x10.*x10;
x21 = x10.*x11;
x22 = x11.*x11;
x23 = x11.*x12;
x24 = x12.*x12;
x25 = x12.*x13;
x26 = x13.*x13;
x27 = x13.*x14;
x28 = x14.*x14;
x29 = x14.*x15;
x30 = x15.*x15;

% First 20 polynoms
Y(:,1:5) = [ones(N,1), x, 2*x2-1, 4*x3-3*x,8*(x4-x2)+1];
Y(:,6:9) = [16*x5-20*x3+5*x,32*x6-48*x4+18*x2-1, 64*x7-112*x5+56*x3-7*x,128*x8-256*x6+160*x4-32*x2+1];
Y(:,10:11) = [9*x-120*x3+432*x5-576*x7+256*x9,-1+50*x2-400*x4+1120*x6-1280*x8+512*x10];
Y(:,12) = -11*x+220*x3-1232*x5+2816*x7-2816*x9+1024*x11;
Y(:,13) = 1-72*x2+840*x4-3584*x6+6912*x8-6144*x10+2048*x12;
Y(:,14) = 13*x-364*x3+2912*x5-9984*x7+16640*x9-13312*x11+4096*x13;
Y(:,15) = -1+98*x2-1568*x4+9408*x6-26880*x8+39424*x10-28672*x12+8192*x14;
Y(:,16) = -15*x+560*x3-6048*x5+28800*x7-70400*x9+92160*x11-61440*x13+16384*x15;
Y(:,17) = 1-128*x2+2688*x4-21504*x6+84480*x8-180224*x10+212992*x12-131072*x14+32768*x16;
Y(:,18) = 17*x-816*x3+11424*x5-71808*x7+239360*x9-452608*x11+487424*x13-278528*x15+65536*x17;
Y(:,19) = -1+162*x2-4320*x4+44352*x6-228096*x8+658944*x10-1118208*x12+1105920*x14-589824*x16+131072*x18;
Y(:,20) = -19*x+1140*x3-20064*x5+160512*x7-695552*x9+1770496*x11-2723840*x13+2490368*x15-1245184*x17+262144*x19;
Y(:,21) = 1-200*x2+6600*x4-84480*x6+549120*x8-2050048*x10+4659200*x12-6553600*x14+5570560*x16-2621440*x18+524288*x20;

% polynoms till 30
Y(:,22) = 21*x-1540*x3+33264*x5-329472*x7+1793792*x9-5870592*x11+12042240*x13-15597568*x15+12386304*x17-5505024*x19+1048576*x21;
Y(:,23) = -1+242*x2-9680*x4+151008*x6-1208064*x8+5637632*x10-16400384*x12+30638080*x14-36765696*x16+27394048*x18-11534336*x20+2097152*x22;
Y(:,24) = -23*x+2024*x3-52624*x5+631488*x7-4209920*x9+17145856*x11-44843008*x13+76873728*x15-85917696*x17+60293120*x19-24117248*x21+4194304*x23;
Y(:,25) = 1-288*x2+13728*x4-256256*x6+2471040*x8-14057472*x10+50692096*x12-120324096*x14+190513152*x16-199229440*x18+132120576*x20-50331648*x22+8388608*x24;
Y(:,26) = 25*x-2600*x3+80080*x5-1144000*x7+9152000*x9-45260800*x11+146227200*x13-317521920*x15+466944000*x17-458752000*x19+288358400*x21-104857600*x23+16777216*x25;
Y(:,27) = -1+338*x2-18928*x4+416416*x6-4759040*x8+32361472*x10-141213696*x12+412778496*x14-825556992*x16+1133117440*x18-1049624576*x20+627048448*x22-218103808*x24+33554432*x26;
Y(:,28) = -27*x+3276*x3-117936*x5+1976832*x7-18670080*x9+109983744*x11-428654592*x13+1143078912*x15-2118057984*x17+2724986880*x19-2387607552*x21+1358954496*x23-452984832*x25+67108864*x27;
Y(:,29) = 1-392*x2+25480*x4-652288*x6+8712704*x8-69701632*x10+361181184*x12-1270087680*x14+3111714816*x16-5369233408*x18+6499598336*x20-5402263552*x22+2936012800*x24-939524096*x26+134217728*x28;
Y(:,30) = 29*x-4060*x3+168896*x5-3281408*x7+36095488*x9-249387008*x11+1151016960*x13-3683254272*x15+8341487616*x17-13463453696*x19+15386804224*x21-12163481600*x23+6325010432*x25-1946157056*x27+268435456*x29;
Y(:,31) = -1+450*x2-33600*x4+990080*x6-15275520*x8+141892608*x10-859955200*x12+3572121600*x14-10478223360*x16+22052208640*x18-33426505728*x20+36175872000*x22-27262976000*x24+13589544960*x26-4026531840*x28+536870912*x30;

if M<=31
    Y = Y(:,1:M);
end

% For larger polynoms use MATLAB (slow)
if M>31
   for k=31:M
      Y(:,k+1) = chebyshevT(k,x);
   end 
end

end

